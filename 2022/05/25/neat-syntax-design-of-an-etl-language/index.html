<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="/attaches/assets/fonts/fonts.css">
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/attaches/assets/next/jquery.fancybox.min.css">
  <link rel="stylesheet" href="/attaches/assets/next/pace-theme-minimal.css">
  <script src="/attaches/assets/next/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"brightliao.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":true,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":true,"lazyload":true,"pangu":true,"comments":{"style":"tabs","active":"gitalk","storage":true,"lazyload":false,"nav":null,"activeClass":"gitalk"},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="Previous posts about Easy SQL  A new ETL language – Easy SQL A guide to write elegant ETL  People like to use Scala because Scala provides powerful type inference and embraces various programming par">
<meta property="og:type" content="article">
<meta property="og:title" content="Neat Syntax Design of an ETL Language (Part 1)">
<meta property="og:url" content="http://brightliao.com/2022/05/25/neat-syntax-design-of-an-etl-language/index.html">
<meta property="og:site_name" content="Bright LGM&#39;s Blog">
<meta property="og:description" content="Previous posts about Easy SQL  A new ETL language – Easy SQL A guide to write elegant ETL  People like to use Scala because Scala provides powerful type inference and embraces various programming par">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://brightliao.com/attaches/2022/2022-05-25-neat-syntax-design-of-an-etl-language/mind-mapping.png">
<meta property="article:published_time" content="2022-05-25T12:00:00.000Z">
<meta property="article:modified_time" content="2022-05-30T08:10:44.121Z">
<meta property="article:author" content="Bright LGM">
<meta property="article:tag" content="编译">
<meta property="article:tag" content="编译器">
<meta property="article:tag" content="数据">
<meta property="article:tag" content="数据平台">
<meta property="article:tag" content="软件工程">
<meta property="article:tag" content="EasySQL">
<meta property="article:tag" content="ETL">
<meta property="article:tag" content="ETL开发">
<meta property="article:tag" content="数据工程">
<meta property="article:tag" content="编程语言">
<meta property="article:tag" content="SQL">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://brightliao.com/attaches/2022/2022-05-25-neat-syntax-design-of-an-etl-language/mind-mapping.png">

<link rel="canonical" href="http://brightliao.com/2022/05/25/neat-syntax-design-of-an-etl-language/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>Neat Syntax Design of an ETL Language (Part 1) | Bright LGM's Blog</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-88944761-1"></script>
    <script>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-88944761-1');
      }
    </script>


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?7438a320b8fb9e84348971d3c0cde17d";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

  <link rel="stylesheet" href="/attaches/assets/next/share.min.css">

<link rel="alternate" href="/atom.xml" title="Bright LGM's Blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Bright LGM's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Code speaks.</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-数据">

    <a href="/data/" rel="section"><i class="fa fa-table fa-fw"></i>数据<span class="badge">39</span></a>

  </li>
        <li class="menu-item menu-item-机器学习">

    <a href="/ml/" rel="section"><i class="fa fa-hand-sparkles fa-fw"></i>机器学习<span class="badge">23</span></a>

  </li>
        <li class="menu-item menu-item-敏捷">

    <a href="/agile/" rel="section"><i class="fa fa-skiing fa-fw"></i>敏捷<span class="badge">20</span></a>

  </li>
        <li class="menu-item menu-item-技术与架构">

    <a href="/arch_tech/" rel="section"><i class="fa fa-warehouse fa-fw"></i>技术与架构<span class="badge">19</span></a>

  </li>
        <li class="menu-item menu-item-每日一思">

    <a href="/daily_thought/" rel="section"><i class="fa fa-quidditch fa-fw"></i>每日一思<span class="badge">17</span></a>

  </li>
        <li class="menu-item menu-item-其他">

    <a href="/other/" rel="section"><i class="fa fa-wave-square fa-fw"></i>其他<span class="badge">28</span></a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-rss">

    <a href="/atom.xml" rel="section"><i class="fa fa-rss fa-fw"></i>RSS</a>

  </li>
      <li class="menu-item menu-item-search" style="border-bottom: solid 1px #eee; margin-bottom: 8px;">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">136</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">54</span></a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">145</span></a>

  </li>

  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

  <a href="https://github.com/gmlove" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://brightliao.com/2022/05/25/neat-syntax-design-of-an-etl-language/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/avatar.png">
      <meta itemprop="name" content="Bright LGM">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Bright LGM's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Neat Syntax Design of an ETL Language (Part 1)
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-05-25 20:00:00" itemprop="dateCreated datePublished" datetime="2022-05-25T20:00:00+08:00">2022-05-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-05-30 16:10:44" itemprop="dateModified" datetime="2022-05-30T16:10:44+08:00">2022-05-30</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%B0%E6%8D%AE/" itemprop="url" rel="index"><span itemprop="name">数据</span></a>
                </span>
            </span>

          
            <span id="/2022/05/25/neat-syntax-design-of-an-etl-language/" class="post-meta-item leancloud_visitors" data-flag-title="Neat Syntax Design of an ETL Language (Part 1)" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span><br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>9.3k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>16 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <link rel="stylesheet" type="text&#x2F;css" href="/attaches/assets/katex/katex.min.css"><p><img data-src="/attaches/2022/2022-05-25-neat-syntax-design-of-an-etl-language/mind-mapping.png" alt="Easy SQL language features mind Mapping" /></p>
<p><strong>Previous posts about Easy SQL</strong></p>
<ul>
<li><a href="/2022/05/04/a-new-etl-language-easy-sql/">A new ETL language – Easy SQL</a></li>
<li><a href="/2022/05/16/a-guide-to-write-elegant-etl/">A guide to write elegant ETL</a></li>
</ul>
<p>People like to use Scala because Scala provides powerful type inference and embraces various programming paradigms. People like to use Python because it’s clean, out-of-the-box, delicate and expressive. People like to use rust because rust provides modern language features and zero-cost abstract.</p>
<span id="more"></span>
<p>How to design a neat ETL programming language that people like to use? Let’s have a look at how Easy SQL does. (We will break this topic into two parts. This is the first part.)</p>
<p>Easy SQL defines a few customized syntax on top of SQL to add imperative characteristics.</p>
<h2 id="language-features-in-easy-sql"><a class="markdownIt-Anchor" href="#language-features-in-easy-sql"></a> Language features in Easy SQL</h2>
<p>For Easy SQL, guided by the design principles, there are a few simple language features added to support these imperative characteristics.</p>
<p>Below is a list of these features:</p>
<ul>
<li>An imperative structure of ETL code.</li>
<li>Variables which could be defined and modified any time.</li>
<li>A way to call external functions.</li>
<li>A way to control whether a step should be executed.</li>
<li>Templates that could be reused in the same ETL file.</li>
<li>Include command that could be used to reuse code at file level.</li>
<li>Debugging support: logging and assertion that could be used for debugging.</li>
<li>A debugger interface.</li>
<li>Other features：write data to tables; list variables; SQL actions.</li>
</ul>
<p>Let’s have a look at the first four features.</p>
<h2 id="syntax-in-easy-sql"><a class="markdownIt-Anchor" href="#syntax-in-easy-sql"></a> Syntax in Easy SQL</h2>
<h3 id="the-imperative-structure"><a class="markdownIt-Anchor" href="#the-imperative-structure"></a> The imperative structure</h3>
<p>The most obvious characteristics of imperative programming is that code will be executed line by line (or piece by piece).<br />
And the declarative way (standard SQL) suggests the opposite, which says, all logic should be defined first and then be executed in one final action.</p>
<p>The major task of designing the imperative structure is to introduce a way to execute SQL step by step.<br />
If we look at Spark DataFrame API, we could find that it works in an imperative way.<br />
For example, we can assign a DataFrame to some variable, then do something about the variable, then transform the variable and assign it to another variable.</p>
<p>In Easy SQL, a simple syntax is introduced as SQL comment, which is <code>target=</code> and <code>-- target=SOME_TARGET</code> in Easy SQL.</p>
<p>There are a few built-in types of targets, which are:</p>
<ul>
<li>variables</li>
<li>temp</li>
<li>cache</li>
<li>broadcast</li>
<li>func</li>
<li>log</li>
<li>check</li>
<li>output</li>
<li>template</li>
<li>list_variables</li>
<li>action</li>
</ul>
<p>When used in Easy SQL ETL, it looks like below:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- target=variables</span></span><br><span class="line"><span class="keyword">select</span> <span class="number">1</span> <span class="keyword">as</span> a, <span class="string">&#x27;2&#x27;</span> <span class="keyword">as</span> b</span><br><span class="line"></span><br><span class="line"><span class="comment">-- target=cache.table_a</span></span><br><span class="line"><span class="keyword">select</span></span><br><span class="line">    <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> some_db.table_a</span><br><span class="line"></span><br><span class="line"><span class="comment">-- target=temp.table_b</span></span><br><span class="line"><span class="keyword">select</span></span><br><span class="line">    <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> some_db.table_b</span><br><span class="line"></span><br><span class="line"><span class="comment">-- target=broadcast.table_c</span></span><br><span class="line"><span class="keyword">select</span></span><br><span class="line">    <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> some_db.table_c</span><br><span class="line"></span><br><span class="line"><span class="comment">-- target=output.some_db.some_table</span></span><br><span class="line"><span class="keyword">select</span> </span><br><span class="line">    <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> table_a a </span><br><span class="line">    <span class="keyword">left</span> <span class="keyword">join</span> table_b b <span class="keyword">on</span> a.id<span class="operator">=</span>b.id</span><br><span class="line">    <span class="keyword">left</span> <span class="keyword">join</span> table_c c <span class="keyword">on</span> a.id<span class="operator">=</span>c.id</span><br></pre></td></tr></table></figure>
<p>There is a SQL query under every <code>target</code> statement.<br />
It means the result of the SQL query is saved to the specified target.<br />
Each <code>target</code> could be viewed as a step and will be executed one by one.</p>
<p>The syntax may seem obvious to most of you. If it is so, it means the design goal is achieved.</p>
<p>Let’s spend some time explaining what it does in the simple ETL above.<br />
If you believe you got it already, please skip it.</p>
<ol>
<li>The first <code>target</code> statement means the SQL query result, <code>a=1 and b='2'</code> in this case, will be saved to the variables target. After this step, the variables could be used.</li>
<li>The second <code>target</code> statement means that the query from table_a will be saved to a cached table named ‘table_a’. Cache table is a concept borrowed from Spark and it means the query result will be cached and could be reused from the following steps to improve performance.</li>
<li>The third <code>target</code> statement means that the query from table_b will be saved to a temporary table named ‘table_b’. And ‘table_b’ could be used in the following steps.</li>
<li>The forth <code>target</code> statement means that the query from table_c will be saved to a broadcasted table named ‘table_c’. Broadcast table is also a concept borrowed from Spark and it means the table will be broadcasted to every node to improve performance. And the table ‘table_c’ could be used in the following steps too.</li>
<li>The fifth <code>target</code> statement means that the joined query result of the above 3 tables will be saved to an output table named ‘some_table’ in ‘some_db’.</li>
</ol>
<h3 id="variables"><a class="markdownIt-Anchor" href="#variables"></a> Variables</h3>
<p>Variables could be defined and modified at any step. The syntax is as the case above.<br />
If we’d like to modify the value of it, we can just add another <code>variables</code> target and write a query with the result of changed ‘a’ and ‘b’.<br />
A simple example is as below:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- target=variables</span></span><br><span class="line"><span class="keyword">select</span> <span class="number">1</span> <span class="keyword">as</span> a, <span class="number">2</span> <span class="keyword">as</span> b</span><br><span class="line"><span class="comment">-- target=variables</span></span><br><span class="line"><span class="keyword">select</span> <span class="number">2</span> <span class="keyword">as</span> a, <span class="number">1</span> <span class="keyword">as</span> b</span><br></pre></td></tr></table></figure>
<p>After the two steps, the value of a will be 2, and it will be 1 for the value of b.</p>
<p>Variables could be referenced anywhere in the following steps with syntax ‘${VAR_NAME}’.</p>
<p>There is a simple example below:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- target=variables</span></span><br><span class="line"><span class="keyword">select</span> <span class="number">1</span> <span class="keyword">as</span> a, <span class="string">&#x27;2&#x27;</span> <span class="keyword">as</span> b</span><br><span class="line"><span class="comment">-- target=variables</span></span><br><span class="line"><span class="keyword">select</span> </span><br><span class="line">    $&#123;a&#125; <span class="keyword">as</span> a</span><br><span class="line">    , $&#123;b&#125; <span class="keyword">as</span> b</span><br><span class="line">    , <span class="number">1</span>$&#123;a&#125; <span class="keyword">as</span> a1</span><br><span class="line">    , $&#123;a&#125; <span class="operator">+</span> $&#123;b&#125; <span class="keyword">as</span> ab</span><br></pre></td></tr></table></figure>
<p>When Easy SQL engine reaches the second step, it will do a variable lookup and simply replace the reference with the real value.<br />
It will replace it with the string value of the variable and converts types when required.</p>
<p>The above example will result in variables: <code>a=1, b=2, a1=11, ab=3</code>.</p>
<p>Besides the user-defined variables, there are a few useful system-defined variables.<br />
When we need to implement some complicated functions, we can use them.</p>
<p>Other things to note about variables:</p>
<ul>
<li>Variable name must be composed of chars ‘0-9a-zA-Z_’.</li>
<li>Variable name is case-insensitive.</li>
</ul>
<h3 id="temporary-tables"><a class="markdownIt-Anchor" href="#temporary-tables"></a> Temporary tables</h3>
<p>Another common case is to save a query to a temporary table for later query. We have already seen a concrete example above.</p>
<p>It works simply as what you expected.</p>
<ul>
<li>The query result will be saved to a temporary table if the target is ‘temp’.</li>
<li>The query result will be saved to a cached temporary table if the target is ‘cache’.</li>
<li>The query result will be saved to a broadcasted temporary table if the target is ‘broadcast’.</li>
</ul>
<p>Speaking of implementation, if the backend is Spark, ‘temp’ ‘cache’ and ‘broadcast’ behave the same as that in Spark,<br />
and with a global temporary table created or replaced with the specified name.<br />
For the other backends in which there is no support of caching and broadcasting of temporary tables,<br />
Easy SQL just create views with the specified name in a temporary default database.</p>
<p>Since there is no actual loading of data for temporary tables, to define a temporary table is a very light-weight operation.<br />
You can create as many temporary tables as you wish.</p>
<p>There are a few things to note when creating temporary tables for different backends.</p>
<ul>
<li>For Spark backend, the name of the temporary table can be reused, but it cannot be reused for the other backends since we cannot create two database views with the same name in the same default database.</li>
<li>For BigQuery backend, we have to specify names like <code>$&#123;temp_db&#125;.SOME_TEMP_TABLE_NAME</code> when query the created temporary table. You guessed it, the ‘temp_db’ is a pre-defined variable provided by Easy SQL engine. This limitation is introduced by BigQuery since there is no such concept of a default database (named dataset in BigQuery).</li>
</ul>
<h3 id="function-calls"><a class="markdownIt-Anchor" href="#function-calls"></a> Function calls</h3>
<p>Function calls is another feature introduced by Easy SQL. It is used to expand the ability of SQL, so that we could do anything in SQL.</p>
<p>Function is defined in Python code and registered before the execution of the ETL.<br />
The syntax to call a function is very intuitive if you have experience of some other programming languages.</p>
<p>Below is an example of function calls.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- target=func.plus(1, 1)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- target=func.do_some_thing()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- target=variables</span></span><br><span class="line"><span class="keyword">select</span> $&#123;plus(<span class="number">2</span>, <span class="number">2</span>)&#125; <span class="keyword">as</span> a</span><br><span class="line"></span><br><span class="line"><span class="comment">-- target=variables</span></span><br><span class="line"><span class="keyword">select</span> $&#123;plus($&#123;a&#125;, <span class="number">2</span>)&#125; <span class="keyword">as</span> b</span><br></pre></td></tr></table></figure>
<p>From the ETL code above, we can find a few things about function calls:</p>
<ul>
<li>Function calls could be used as a ‘func’ target.</li>
<li>The result of function calls could be used as a variable.</li>
<li>Parameters of function calls could be variables.</li>
</ul>
<p>Besides these, there are a few other things to note:</p>
<ul>
<li>One function call expression must be in one line of code.</li>
<li>When functions are called, all non-variable parameters are passed as strings even if it looks like an integer. In the function implementation, we need to convert types from string to its real type.</li>
<li>There should be no chars from any of <code>,()</code> in literal parameters. If there is, we need to define a variable before the function call and pass in the variable as a parameter.</li>
<li>Any user-defined variable will be converted to string and passed to functions as string value. We may need to convert types in the function implementation.</li>
<li>All functions in the Python <code>builtin</code> module and <code>operators</code> module are automatically registered, so we can use a lot of Python functions without providing an implementation.</li>
</ul>
<p>Before execution of the above ETL, we need to define the functions referenced in the ETL. Followed by the above rules, an example of the function implementations could be:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">plus</span>(<span class="params">a: <span class="built_in">str</span>, b: <span class="built_in">str</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>(a) + <span class="built_in">int</span>(b)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">do_some_thing</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;do things...&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>And then after the execution of the ETL, the value of the variables will be: <code>a=4, b=6</code>.</p>
<h3 id="control-execution-flow"><a class="markdownIt-Anchor" href="#control-execution-flow"></a> Control execution flow</h3>
<p>For an imperative language, providing a way to control execution flow is important.</p>
<p>Back to the top, there is a case mentioned that<br />
‘we would like to use large computing resources when we’re handling data in the first partition since the amount of data there is far larger than that in the other partitions’.<br />
In order to implement this in ETL, we need to control the execution flow to configure a large computing resource.</p>
<p>A common way in general programming language to handle this is to provide some ‘if’ statement.<br />
And we need to provide a condition expression for ‘if’ statement.<br />
The inner action of ‘if’ statement is then executed according to the true or false value of the condition expression.</p>
<p>Easy SQL provides a similar way to control execution flow.<br />
We can control if a step needs to be executed by providing a ‘if’ statement after any step definition.<br />
Below is an example:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- target=func.do_some_thing(), if=bool()</span></span><br><span class="line"><span class="comment">-- target=func.do_another_thing(), if=bool(1)</span></span><br><span class="line"><span class="comment">-- target=func.do_a_third_thing(), if=bool($&#123;some_variable_indicator&#125;)</span></span><br><span class="line"><span class="comment">-- target=temp.table_a, if=bool()</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> some_db.table_a</span><br><span class="line"><span class="comment">-- target=variables, if=bool(1)</span></span><br><span class="line"><span class="keyword">select</span> <span class="number">1</span> <span class="keyword">as</span> a</span><br></pre></td></tr></table></figure>
<p>From the example, we know the following things about ‘if’ statement in Easy SQL:</p>
<ul>
<li>There must be a function call following the ‘if’ statement.</li>
<li>The function call must return a boolean value to indicate if the step needs to be executed.</li>
<li>Any step could be controlled by a ‘if’ statement, including ‘func’ ‘temp’ ‘variables’ and so on.</li>
</ul>
<h2 id="summary"><a class="markdownIt-Anchor" href="#summary"></a> Summary</h2>
<p>In this post, we talked about the first 4 language features.</p>
<ul>
<li>An imperative structure of ETL code.</li>
<li>Variables which could be defined and modified any time.</li>
<li>A way to call external functions.</li>
<li>A way to control whether a step should be executed.</li>
</ul>
<p>For the other features, let’s talk about it in a post later on.</p>
<p>You may already find it useful and would like to have a try. You can get all the information required to get started from the GitHub repo <a target="_blank" rel="noopener" href="https://github.com/easysql/easy_sql">here</a> and the docs <a target="_blank" rel="noopener" href="https://easy-sql.readthedocs.io/en/latest/">here</a>.</p>
<p>If you find any issues, you’re welcome to raise it in GitHub Issues and PRs are welcomed as well!</p>

    </div>

    
    
    
    <div class="share-component" style="text-align: right;" data-sites="wechat,weibo,douban,qq,linkedin,facebook,twitter" data-description="一键分享到微信，微博，QQ，豆瓣"></div>
    
      
  <div class="popular-posts-header">相关文章</div>
  <ul class="popular-posts">
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/2022/05/04/a-new-etl-language-easy-sql/" rel="bookmark">A New ETL Language -- Easy SQL</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/2022/05/16/a-guide-to-write-elegant-etl/" rel="bookmark">A Guide to Write Elegant ETL</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/2022/05/30/neat-syntax-design-of-an-etl-language-part-2/" rel="bookmark">Neat Syntax Design of an ETL Language (Part 2)</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/2022/06/08/efficient-etl-testing/" rel="bookmark">Efficient ETL Testing</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/2022/08/10/agile-data-engineering-practices/" rel="bookmark">敏捷数据工程实践</a></div>
    </li>
  </ul>

        

  <div class="followme">
    <p>欢迎关注我的其它发布渠道</p>

    <div class="social-list">

        <div class="social-item">
          <a target="_blank" class="social-link" href="/images/wechat.png">
            <span class="icon">
              <i class="fab fa-weixin"></i>
            </span>

            <span class="label">WeChat</span>
          </a>
        </div>

        <div class="social-item">
          <a target="_blank" class="social-link" href="/atom.xml">
            <span class="icon">
              <i class="fa fa-rss"></i>
            </span>

            <span class="label">RSS</span>
          </a>
        </div>

        <div class="social-item">
          <a target="_blank" class="social-link" href="https://www.infoq.cn/u/brightliao/publish">
            <span class="icon">
              <i class="fas fa-info"></i>
            </span>

            <span class="label">InfoQ</span>
          </a>
        </div>
    </div>
  </div>


      <footer class="post-footer">
          
          <div class="post-tags">
              <a href="/tags/%E7%BC%96%E8%AF%91/" rel="tag"><i class="fa fa-tag"></i> 编译</a>
              <a href="/tags/%E7%BC%96%E8%AF%91%E5%99%A8/" rel="tag"><i class="fa fa-tag"></i> 编译器</a>
              <a href="/tags/%E6%95%B0%E6%8D%AE/" rel="tag"><i class="fa fa-tag"></i> 数据</a>
              <a href="/tags/%E6%95%B0%E6%8D%AE%E5%B9%B3%E5%8F%B0/" rel="tag"><i class="fa fa-tag"></i> 数据平台</a>
              <a href="/tags/%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B/" rel="tag"><i class="fa fa-tag"></i> 软件工程</a>
              <a href="/tags/easysql/" rel="tag"><i class="fa fa-tag"></i> EasySQL</a>
              <a href="/tags/etl/" rel="tag"><i class="fa fa-tag"></i> ETL</a>
              <a href="/tags/etl%E5%BC%80%E5%8F%91/" rel="tag"><i class="fa fa-tag"></i> ETL开发</a>
              <a href="/tags/%E6%95%B0%E6%8D%AE%E5%B7%A5%E7%A8%8B/" rel="tag"><i class="fa fa-tag"></i> 数据工程</a>
              <a href="/tags/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/" rel="tag"><i class="fa fa-tag"></i> 编程语言</a>
              <a href="/tags/sql/" rel="tag"><i class="fa fa-tag"></i> SQL</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/05/24/5-properties-of-good-code-cupid/" rel="prev" title="好代码的五个特质-CUPID">
      <i class="fa fa-chevron-left"></i> 好代码的五个特质-CUPID
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/05/30/neat-syntax-design-of-an-etl-language-part-2/" rel="next" title="Neat Syntax Design of an ETL Language (Part 2)">
      Neat Syntax Design of an ETL Language (Part 2) <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="gitalk-container"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#language-features-in-easy-sql"><span class="nav-number">1.</span> <span class="nav-text"> Language features in Easy SQL</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#syntax-in-easy-sql"><span class="nav-number">2.</span> <span class="nav-text"> Syntax in Easy SQL</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#the-imperative-structure"><span class="nav-number">2.1.</span> <span class="nav-text"> The imperative structure</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#variables"><span class="nav-number">2.2.</span> <span class="nav-text"> Variables</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#temporary-tables"><span class="nav-number">2.3.</span> <span class="nav-text"> Temporary tables</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#function-calls"><span class="nav-number">2.4.</span> <span class="nav-text"> Function calls</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#control-execution-flow"><span class="nav-number">2.5.</span> <span class="nav-text"> Control execution flow</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#summary"><span class="nav-number">3.</span> <span class="nav-text"> Summary</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Bright LGM"
      src="/avatar.png">
  <p class="site-author-name" itemprop="name">Bright LGM</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">136</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">54</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">145</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/gmlove" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;gmlove" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="/images/wechat.png" title="WeChat → &#x2F;images&#x2F;wechat.png"><i class="fab fa-wechat fa-fw"></i>WeChat</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:gmliao@thoughtworks.com" title="E-Mail → mailto:gmliao@thoughtworks.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://insights.thoughtworks.cn/" title="https:&#x2F;&#x2F;insights.thoughtworks.cn" rel="noopener" target="_blank">Thoughtworks洞见</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://www.thoughtworks.com/radar" title="https:&#x2F;&#x2F;www.thoughtworks.com&#x2F;radar" rel="noopener" target="_blank">Thoughtworks技术雷达</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://shaogefenhao.com/" title="https:&#x2F;&#x2F;shaogefenhao.com" rel="noopener" target="_blank">少个分号（DDD思考者）</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://www.bmpi.dev/" title="https:&#x2F;&#x2F;www.bmpi.dev" rel="noopener" target="_blank">马大伟（被动收入实践者）</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://maguangguang.xyz/" title="https:&#x2F;&#x2F;maguangguang.xyz&#x2F;" rel="noopener" target="_blank">麻广广（企业架构设计）</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://www.icodebook.com/" title="http:&#x2F;&#x2F;www.icodebook.com&#x2F;" rel="noopener" target="_blank">爱码叔iCodeBook（软件架构）</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://liuranthinking.com/" title="https:&#x2F;&#x2F;liuranthinking.com&#x2F;" rel="noopener" target="_blank">刘冉思辨悟（软件测试与质量沉思）</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://www.bylinzi.com/" title="https:&#x2F;&#x2F;www.bylinzi.com" rel="noopener" target="_blank">BY林子（关注质量，不止测试）</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://qualityfocus.club/yxn" title="https:&#x2F;&#x2F;qualityfocus.club&#x2F;yxn" rel="noopener" target="_blank">于晓南（QualityFocus）</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://www.niezitalk.com/" title="http:&#x2F;&#x2F;www.niezitalk.com&#x2F;" rel="noopener" target="_blank">聂子云（数字化转型咨询）</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://www.kaifengzhang.com/" title="http:&#x2F;&#x2F;www.kaifengzhang.com&#x2F;" rel="noopener" target="_blank">张凯峰（打造影响力）</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://taoshu.in/" title="https:&#x2F;&#x2F;taoshu.in&#x2F;" rel="noopener" target="_blank">涛叔（温故知新，笔耕不辍）</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        
  <div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">蜀ICP备2022013263号 </a>
  </div>

<div class="copyright">
  
  &copy; 2015 – 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Bright LGM</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">642k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">17:50</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        






<script>
  (function() {
    function leancloudSelector(url) {
      url = encodeURI(url);
      return document.getElementById(url).querySelector('.leancloud-visitors-count');
    }

    function addCount(Counter) {
      var visitors = document.querySelector('.leancloud_visitors');
      var url = decodeURI(visitors.id);
      var title = visitors.dataset.flagTitle;

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url })))
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length > 0) {
            var counter = results[0];
            leancloudSelector(url).innerText = counter.time + 1;
            Counter('put', '/classes/Counter/' + counter.objectId, { time: { '__op': 'Increment', 'amount': 1 } })
              .catch(error => {
                console.error('Failed to save visitor count', error);
              });
          } else {
              Counter('post', '/classes/Counter', { title, url, time: 1 })
                .then(response => response.json())
                .then(() => {
                  leancloudSelector(url).innerText = 1;
                })
                .catch(error => {
                  console.error('Failed to create', error);
                });
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    function showTime(Counter) {
      var visitors = document.querySelectorAll('.leancloud_visitors');
      var entries = [...visitors].map(element => {
        return decodeURI(element.id);
      });

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url: { '$in': entries } })))
        .then(response => response.json())
        .then(({ results }) => {
          for (let url of entries) {
            let target = results.find(item => item.url === url);
            leancloudSelector(url).innerText = target ? target.time : 0;
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    let { app_id, app_key, server_url } = {"enable":true,"app_id":"4BFdbWUTO8tJBOkCpS2nj4df-gzGzoHsz","app_key":"9jxpPRQJh9dxgB6Ndb1HYuKO","security":false,"betterPerformance":true};
    function fetchData(api_server) {
      var Counter = (method, url, data) => {
        return fetch(`${api_server}/1.1${url}`, {
          method,
          headers: {
            'X-LC-Id'     : app_id,
            'X-LC-Key'    : app_key,
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
      };
      if (CONFIG.page.isPost) {
        // if (CONFIG.hostname !== location.hostname) return;
        addCount(Counter);
      } else if (document.querySelectorAll('.post-title-link').length >= 1) {
        showTime(Counter);
      }
    }

    let api_server = app_id.slice(-9) !== '-MdYXbMMI' ? server_url : `https://${app_id.slice(0, 8).toLowerCase()}.api.lncldglobal.com`;

    if (api_server) {
      fetchData(api_server);
    } else {
      fetch('https://app-router.leancloud.cn/2/route?appId=' + app_id)
        .then(response => response.json())
        .then(({ api_server }) => {
          fetchData('https://' + api_server);
        });
    }
  })();
</script>


      </div>
    </footer>
  </div>

  
  <script size="300" alpha="0.6" zIndex="-1" src="/attaches/assets/next/canvas-ribbon.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="/attaches/assets/next/jquery.min.js"></script>
  <script src="/attaches/assets/next/jquery.fancybox.min.js"></script>
  <script src="/attaches/assets/next/medium-zoom.min.js"></script>
  <script src="/attaches/assets/next/lozad.min.js"></script>
  <script src="/attaches/assets/next/pangu.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

  <script src="/attaches/assets/next/jquery.share.min.js"></script>


<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js?44.js"></script>

<script src="/js/bookmark.js"></script>




  
  <script>
    (function(){
      var canonicalURL, curProtocol;
      //Get the <link> tag
      var x=document.getElementsByTagName("link");
		//Find the last canonical URL
		if(x.length > 0){
			for (i=0;i<x.length;i++){
				if(x[i].rel.toLowerCase() == 'canonical' && x[i].href){
					canonicalURL=x[i].href;
				}
			}
		}
    //Get protocol
	    if (!canonicalURL){
	    	curProtocol = window.location.protocol.split(':')[0];
	    }
	    else{
	    	curProtocol = canonicalURL.split(':')[0];
	    }
      //Get current URL if the canonical URL does not exist
	    if (!canonicalURL) canonicalURL = window.location.href;
	    //Assign script content. Replace current URL with the canonical URL
      !function(){var e=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,r=canonicalURL,t=document.referrer;if(!e.test(r)){var n=(String(curProtocol).toLowerCase() === 'https')?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif";t?(n+="?r="+encodeURIComponent(document.referrer),r&&(n+="&l="+r)):r&&(n+="?l="+r);var i=new Image;i.src=n}}(window);})();
  </script>




  
<script src="/js/local-search.js"></script>











<script>
if (document.querySelectorAll('pre.mermaid').length) {
  NexT.utils.getScript('/attaches/assets/next/mermaid.min.js', () => {
    mermaid.initialize({
      theme    : 'forest',
      logLevel : 3,
      flowchart: { curve     : 'linear' },
      gantt    : { axisFormat: '%m/%d/%Y' },
      sequence : { actorMargin: 50 }
    });
  }, window.mermaid);
}
</script>


  

  

<link rel="stylesheet" href="/attaches/assets/next/gitalk.min.css">

<script>
NexT.utils.loadComments(document.querySelector('#gitalk-container'), () => {
  NexT.utils.getScript('/attaches/assets/next/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID    : '75eb53812430d581cd14',
      clientSecret: '5f50853e9d5be69ddc4094d7ec896fc6e0f9f14b',
      repo        : 'gmlove.github.io',
      owner       : 'gmlove',
      admin       : ['gmlove'],
      id          : '196732f4afe98ce673db8fac5d37632d',
        language: 'zh-CN',
      distractionFreeMode: true
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
});
</script>

</body>
</html>
